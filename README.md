Select max(DATE_TIME) into vDate from T_KPO_SINTER_CHEMICAL;
     If vDate is Null Then
        vDate:='20-Dec-2015';
     End If;
        Merge into KPO.T_KPO_SINTER_CHEMICAL t
        Using CRMTXRF.SAMPLE_TEST_REPORT@MISPROD s 
        On (s.s.STR_ANALYSIS_VALUE<=100 and s.STR_TEST_DATE=t.DATE_TIME AND s.STR_DEPT_CODE='L204' And s.STR_TEST_GROUP_CODE='T342' And t.SHIFT=Decode(s.STR_TEST_SHIFT,Null,'E',s.STR_TEST_SHIFT))
        When Matched Then
            Update Set 
                      CAO=Decode(s.STR_ELEMENT_CODE,'E011',Decode(s.STR_ANALYSIS_VALUE,0,Null,s.STR_ANALYSIS_VALUE)) CAO,
                      SIO2=Decode(s.STR_ELEMENT_CODE,'E012',Decode(s.STR_ANALYSIS_VALUE,0,Null,s.STR_ANALYSIS_VALUE)) SiO2,    
                      P=Decode(s.STR_ELEMENT_CODE,'E026',Decode(s.STR_ANALYSIS_VALUE,0,Null,s.STR_ANALYSIS_VALUE)) P,
                      MGO=Decode(s.STR_ELEMENT_CODE,'E015',Decode(s.STR_ANALYSIS_VALUE,0,Null,s.STR_ANALYSIS_VALUE)) MGO,
                      MNO=Decode(s.STR_ELEMENT_CODE,'E016',Decode(s.STR_ANALYSIS_VALUE,0,Null,s.STR_ANALYSIS_VALUE)) MNO,
                      AL2O3=Decode(s.STR_ELEMENT_CODE,'E017',Decode(s.STR_ANALYSIS_VALUE,0,Null,s.STR_ANALYSIS_VALUE)) AL2O3,
                      TIO2=Decode(s.STR_ELEMENT_CODE,'E018',Decode(s.STR_ANALYSIS_VALUE,0,Null,s.STR_ANALYSIS_VALUE)) TIO2,
                      K2O=Decode(s.STR_ELEMENT_CODE,'E020',Decode(s.STR_ANALYSIS_VALUE,0,Null,s.STR_ANALYSIS_VALUE)) K2O,
                      FE=Decode(s.STR_ELEMENT_CODE,'E042',Decode(s.STR_ANALYSIS_VALUE,0,Null,s.STR_ANALYSIS_VALUE)) Fe,
                      FEO=Decode(s.STR_ELEMENT_CODE,'E009',Decode(s.STR_ANALYSIS_VALUE,0,Null,s.STR_ANALYSIS_VALUE)) FeO, 
                      NA2O=Decode(s.STR_ELEMENT_CODE,'E023',Decode(s.STR_ANALYSIS_VALUE,0,Null,s.STR_ANALYSIS_VALUE)) NA2O,
                      CL=Decode(s.STR_ELEMENT_CODE,'E116',Decode(s.STR_ANALYSIS_VALUE,0,Null,s.STR_ANALYSIS_VALUE)) CL,
                      S=Decode(s.STR_ELEMENT_CODE,'E014',Decode(s.STR_ANALYSIS_VALUE,0,Null,s.STR_ANALYSIS_VALUE)) S,
                      CR2O3=Decode(s.STR_ELEMENT_CODE,'E019',Decode(s.STR_ANALYSIS_VALUE,0,Null,s.STR_ANALYSIS_VALUE)) CR2O3,
                      ZNO=Decode(s.STR_ELEMENT_CODE,'D101',Decode(s.STR_ANALYSIS_VALUE,0,Null,s.STR_ANALYSIS_VALUE)) ZNO,
                      ZN=Decode(s.STR_ELEMENT_CODE,'D101',Decode(s.STR_ANALYSIS_VALUE,0,Null,s.STR_ANALYSIS_VALUE))*0.8 ZN
        When Not Matched Then
        Insert KPO.T_KPO_SINTER_CHEMICAL(DATE_TIME,SHIFT,SOURCE,CAO,SIO2,P,MGO,MNO,AL2O3,TIO2,K2O,FE,FEO,NA2O,CL,S,CR2O3,ZN,ZNO)       
        Values(s.STR_TEST_DATE,Decode(s.STR_TEST_SHIFT,Null,'E',s.STR_TEST_SHIFT)),'SP1',
        Decode(s.STR_ELEMENT_CODE,'E011',Decode(s.STR_ANALYSIS_VALUE,0,Null,s.STR_ANALYSIS_VALUE)),
        Decode(s.STR_ELEMENT_CODE,'E012',Decode(s.STR_ANALYSIS_VALUE,0,Null,s.STR_ANALYSIS_VALUE)) SiO2,    
        Decode(s.STR_ELEMENT_CODE,'E026',Decode(s.STR_ANALYSIS_VALUE,0,Null,s.STR_ANALYSIS_VALUE)) P,
        Decode(s.STR_ELEMENT_CODE,'E015',Decode(s.STR_ANALYSIS_VALUE,0,Null,s.STR_ANALYSIS_VALUE)) MGO,
        Decode(s.STR_ELEMENT_CODE,'E016',Decode(s.STR_ANALYSIS_VALUE,0,Null,s.STR_ANALYSIS_VALUE)) MNO,
        Decode(s.STR_ELEMENT_CODE,'E017',Decode(s.STR_ANALYSIS_VALUE,0,Null,s.STR_ANALYSIS_VALUE)) AL2O3,
        Decode(s.STR_ELEMENT_CODE,'E018',Decode(s.STR_ANALYSIS_VALUE,0,Null,s.STR_ANALYSIS_VALUE)) TIO2,
        Decode(s.STR_ELEMENT_CODE,'E020',Decode(s.STR_ANALYSIS_VALUE,0,Null,s.STR_ANALYSIS_VALUE)) K2O,
        Decode(s.STR_ELEMENT_CODE,'E042',Decode(s.STR_ANALYSIS_VALUE,0,Null,s.STR_ANALYSIS_VALUE)) Fe,
        Decode(s.STR_ELEMENT_CODE,'E009',Decode(s.STR_ANALYSIS_VALUE,0,Null,s.STR_ANALYSIS_VALUE)) FeO, 
        Decode(s.STR_ELEMENT_CODE,'E023',Decode(s.STR_ANALYSIS_VALUE,0,Null,s.STR_ANALYSIS_VALUE)) NA2O,
        Decode(s.STR_ELEMENT_CODE,'E116',Decode(s.STR_ANALYSIS_VALUE,0,Null,s.STR_ANALYSIS_VALUE)) CL,
        Decode(s.STR_ELEMENT_CODE,'E014',Decode(s.STR_ANALYSIS_VALUE,0,Null,s.STR_ANALYSIS_VALUE)) S,
        Decode(s.STR_ELEMENT_CODE,'E019',Decode(s.STR_ANALYSIS_VALUE,0,Null,s.STR_ANALYSIS_VALUE)) CR2O3,
        Decode(s.STR_ELEMENT_CODE,'D101',Decode(s.STR_ANALYSIS_VALUE,0,Null,s.STR_ANALYSIS_VALUE)) ZNO,
        Decode(s.STR_ELEMENT_CODE,'D101',Decode(s.STR_ANALYSIS_VALUE,0,Null,s.STR_ANALYSIS_VALUE))*0.8 ZN);
        Commit;
