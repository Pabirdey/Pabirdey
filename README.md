SELECT 
    b.TAG_ID,
    b.WEB_COLUMN AS MATERIAL_NAME,

    CASE 
        WHEN b.FUR_NAME IN ('C','E','F') 
        THEN ROUND(NVL(a.VALUE,0) / 1000,2)
        ELSE 0
    END AS VALUE_TON,

    CASE 
        WHEN b.FUR_NAME IN ('C','E','F') 
        THEN ROUND(NVL(a.VALUE,0),2)
        ELSE 0
    END AS VALUE_KG

FROM IMTG.T_ATOF_BIN_DETAILS b
LEFT JOIN TEST.T_FURNACES_PROC_HM_PROD a
    ON b.TAG_ID = a.TAG_ID
   AND TRUNC(a.TIMESTAMP) = TRUNC(p_date)

WHERE b.REQUIRED = 'Y'
  AND b.WEB_COLUMN IS NOT NULL
  AND b.FUR_NAME = p_furnace

ORDER BY b.WEB_SL_NO;
