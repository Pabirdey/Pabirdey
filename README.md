SELECT 
    b.Timestamp AS DATE_MONTH,
    'TSK_PELLET' AS PLANT,
    ROUND(a.ACTUAL_QUANTITY) AS NET_PROD,
    ROUND(b.NET_PRODUCTIVITY, 2) AS NET_PRODUCTIVITY,
    NULL AS COLUMN_1,
    ROUND(c.FE, 2) AS FE,
    ROUND(c.CAO / NULLIF(c.SIO2, 0), 2) AS B2,
    ROUND(c.AL2O3, 3) AS AL2O3,
    ROUND(c.P, 3) AS PHOS,
    ROUND(c.K2O, 3) AS K2O,
    ROUND(d.AVG_CCS) AS CCS_CRMT,
    ROUND(c.PCT_TUM_6P3MM, 1) AS TUMBLER_PLS_6P3_MM,
    ROUND(c.PLS_TUM_MIN_0P5MM, 3) AS TUMBLER_MIN_0P5_MM,
    ROUND(AVG(e.RDI), 2) AS RDI,
    ROUND(AVG(f.RI), 2) AS RI,
    ROUND(AVG(g.SWELLING_INDEX), 2) AS SWELLING_INDEX_CRMT,
    AVG(
        (NVL(h.ENG_CONS_DRYER_1, 0) + NVL(i.ENG_CONS_DRYER_2, 0)) /
        DECODE(
            ((CASE WHEN h.ENG_CONS_DRYER_1 > 0 THEN 1 ELSE 0 END) +
             (CASE WHEN i.ENG_CONS_DRYER_2 > 0 THEN 1 ELSE 0 END)),
            0, NULL,
            ((CASE WHEN h.ENG_CONS_DRYER_1 > 0 THEN 1 ELSE 0 END) +
             (CASE WHEN i.ENG_CONS_DRYER_2 > 0 THEN 1 ELSE 0 END))
        )
    ) AS ENG_CONS,
    NULL AS COL2,
    NULL AS COL3,
    NULL AS COL4
FROM 
    KPO.T_KPO_PELLET_PROD_MONTHLY b
    LEFT JOIN KPO.t_kpo_Pellet_quality_monthly c 
        ON b.Timestamp = c.DATE_MONTH
       AND c.SOURCE = 'PRODUCT'
       AND c.PLANT = 'KPO-Pellet Plant'
    LEFT JOIN KPO.T_KPO_COST_DATA a 
        ON TRUNC(b.Timestamp, 'MON') = TRUNC(a.DATE_TIME, 'MON')
       AND a.AREA = '100028600'
       AND a.COST_TYPE = 'MC'
       AND a.COST_ELEMENT = '111105481'
    LEFT JOIN KPO.T_KPO_PELLET_CCS_MONTHLY d 
        ON b.Timestamp = d.DATE_MONTH
    LEFT JOIN KPO.T_KPO_PELLET_RDI_DAILY e 
        ON b.Timestamp = TRUNC(e.DATE_TIME, 'MON')
       AND TRUNC(e.DATE_TIME, 'MON') < TRUNC(SYSDATE, 'MON')
    LEFT JOIN KPO.T_KPO_PELLET_RI_DAILY f 
        ON b.Timestamp = TRUNC(f.DATE_TIME, 'MON')
       AND TRUNC(f.DATE_TIME, 'MON') < TRUNC(SYSDATE, 'MON')
    LEFT JOIN KPO.T_KPO_PELLET_SWELLING_INDEX_DAILY g 
        ON b.Timestamp = TRUNC(g.DATE_TIME, 'MON')
       AND TRUNC(g.DATE_TIME, 'MON') < TRUNC(SYSDATE, 'MON')
    LEFT JOIN KPO.T_KPO_PELLET_DRYING_GRIND_PROCESS_DAILY h 
        ON TRUNC(b.Timestamp, 'MON') = TRUNC(h.Timestamp, 'MON')
       AND TRUNC(h.Timestamp, 'MON') < TRUNC(SYSDATE, 'MON')
    LEFT JOIN KPO.T_KPO_PELLET_DRYGRIND_STREAM2_DAILY i 
        ON TRUNC(b.Timestamp, 'MON') = TRUNC(i.Timestamp, 'MON')
       AND TRUNC(i.Timestamp, 'MON') < TRUNC(SYSDATE, 'MON')
WHERE 
    b.Timestamp >= SYSDATE - 200
GROUP BY 
    b.Timestamp,
    b.NET_PRODUCTIVITY,
    c.FE, c.CAO, c.SIO2, c.AL2O3, c.P, c.K2O,
    d.AVG_CCS,
    c.PCT_TUM_6P3MM,
    c.PLS_TUM_MIN_0P5MM,
    a.ACTUAL_QUANTITY
ORDER BY 
    b.Timestamp;