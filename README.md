SELECT 
    TRUNC(a.Timestamp, 'MON') AS DATE_MONTH,
    'TSJ_SP2' AS PLANT,
    a.NET_PROD,
    ROUND(a.NETPRODUCTIVITY, 1) AS NETPRODUCTIVITY,
    ROUND(a.AVAILABILITY, 1) AS AVAILABILITY,
    ROUND(b.CAO, 1) AS CAO,
    ROUND(b.AL2O3, 2) AS AL2O3,
    ROUND(b.P, 3) AS PHOS,
    ROUND(b.K2O, 3) AS K2O,
    ROUND(b.CAO_SIO2, 2) AS B2,
    ROUND(b.S_6P3MM, 1) AS TI,
    ROUND(b.RDI, 1) AS RDI,
    ROUND(c.IRON_ORE_KGPT_GROSS, 0) AS IRON_ORE_FINES,

    ROUND(
        NVL(c.LD_SLAG_KGPT_GROSS, 0) +
        NVL(c.MILL_SCALE_KGPT_GROSS, 0) +
        NVL(c.WRP_KGPT_GROSS, 0) +
        NVL(c.FLUE_DUST_KGPT_GROSS, 0) +
        NVL(c.LD_SLUDGE_KGPT_GROSS, 0) +
        NVL(c.ESP_DUST_KGPT_GROSS, 0) +
        NVL(c.FERRIC_OXIDE_KGPT_GROSS, 0) +
        NVL(c.MILL_SLUDGE_KGPT_GROSS, 0) +
        NVL(c.REJ_CLIME_KGPT_GROSS, 0) +
        (AVG(e.ACTUAL_QUANTITY) / NULLIF(AVG(a.SINTER_PROD), 0)) * 1000
    , 2) AS SOLID_WASTE,

    ROUND(d.TOTAL_FUEL_RATE, 1) AS SOLID_FUEL_RATE,
    ROUND(d.SPM_LEVEL_WG_ESP, 1) AS SPM

FROM imtg.T_SP2_PRODUCTION_MONTHLY a
LEFT JOIN imtg.T_SP2_SINTER_QUALITY_MONTHLY b
    ON TRUNC(a.Timestamp) = TRUNC(b.DATE_TIME)
LEFT JOIN imtg.t_sinter_rm_kgpt_monthly c
    ON TRUNC(a.Timestamp) = TRUNC(c.DATE_MONTH)
    AND c.PLANT = 'SP2'
LEFT JOIN imtg.T_SP2_PROCESS_MONTHLY d
    ON a.Timestamp = d.Timestamp
LEFT JOIN imtg.T_COST_DATA e
    ON TRUNC(a.Timestamp, 'MON') = TRUNC(e.DATE_TIME, 'MON')
    AND e.AREA = '100000189'
    AND e.COST_ELEMENT IN ('000000000150002860', '000000000150002862')

WHERE a.Timestamp >= TO_DATE('01-SEP-2024', 'DD-MON-YYYY')
GROUP BY 
    TRUNC(a.Timestamp, 'MON'),
    a.NET_PROD,
    a.NETPRODUCTIVITY,
    a.AVAILABILITY,
    b.CAO,
    b.AL2O3,
    b.P,
    b.K2O,
    b.CAO_SIO2,
    b.S_6P3MM,
    b.RDI,
    c.IRON_ORE_KGPT_GROSS,
    d.TOTAL_FUEL_RATE,
    d.SPM_LEVEL_WG_ESP;