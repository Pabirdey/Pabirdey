SELECT 
    a.Timestamp,
    ROUND(a.NET_PROD) AS NET_PROD,
    ROUND(a.NET_PRODUCTIVITY, 1) AS NET_PRODUCTIVITY,
    ROUND(a.ACTUAL_AVAILABILITY, 1) AS ACTUAL_AVAILABILITY,
    ROUND(b.FE, 1) AS FE,
    ROUND(b.CAO / DECODE(b.SIO2, 0, NULL, b.SIO2), 2) AS B2,
    ROUND(b.AL2O3, 2) AS AL2O3,
    ROUND(b.P, 3) AS P,
    ROUND(b.K2O, 3) AS K2O,
    ROUND(b.CCS_CRMT) AS CCS_CRMT,
    ROUND(b.TUMBLER_PLS_6P3_MM, 2) AS TUMBLER_PLS_6P3_MM,
    ROUND(b.TUMBLER_MIN_0P5_MM, 2) AS TUMBLER_MIN_0P5_MM,
    ROUND(b.SWELLING_INDEX_CRMT, 2) AS SWELLING_INDEX_CRMT,
    ROUND(b.RDI, 2) AS RDI,
    ROUND(b.RI, 1) AS RI,

    NVL(AVG(CASE WHEN COST_ELEMENT LIKE '%120000056%' AND AREA LIKE '%100021212%' THEN ACTUAL_QUANTITY ELSE NULL END), 0)
    +
    NVL((
        NVL(AVG(CASE WHEN COST_ELEMENT LIKE '%120000055%' AND AREA LIKE '%100021212%' THEN ACTUAL_QUANTITY ELSE NULL END), 0)
        +
        NVL(AVG(CASE WHEN COST_ELEMENT LIKE '%120000057%' AND AREA LIKE '%100021212%' THEN ACTUAL_QUANTITY ELSE NULL END), 0)
    ) / AVG(CASE WHEN COST_ELEMENT LIKE '%100021211%' AND AREA LIKE '%100021211%' THEN ACTUAL_QUANTITY ELSE NULL END) * 1000, 0)
    +
    NVL((
        NVL(AVG(CASE WHEN COST_ELEMENT LIKE '%120005660%' AND AREA LIKE '%100021212%' THEN ACTUAL_QUANTITY ELSE NULL END), 0)
    ) / AVG(CASE WHEN COST_ELEMENT LIKE '%100021211%' AND AREA LIKE '%100021211%' THEN ACTUAL_QUANTITY ELSE NULL END) * 1000, 0)
    +
    NVL((
        NVL(AVG(CASE WHEN COST_ELEMENT LIKE '%120005731%' AND AREA LIKE '%100021212%' THEN ACTUAL_QUANTITY ELSE NULL END), 0)
        +
        NVL(AVG(CASE WHEN COST_ELEMENT LIKE '%120006250%' AND AREA LIKE '%100021212%' THEN ACTUAL_QUANTITY ELSE NULL END), 0)
        +
        NVL(AVG(CASE WHEN COST_ELEMENT LIKE '%120006280%' AND AREA LIKE '%100021212%' THEN ACTUAL_QUANTITY ELSE NULL END), 0)
    ) / AVG(CASE WHEN COST_ELEMENT LIKE '%100021211%' AND AREA LIKE '%100021211%' THEN ACTUAL_QUANTITY ELSE NULL END) * 1000, 0)
    AS IRON_ORE_FINES

FROM 
    (imtg.t_Pellet_production_monthly a
     FULL OUTER JOIN imtg.t_Pellet_quality_monthly b ON a.Timestamp = b.Date_Time)
FULL OUTER JOIN 
    imtg.T_COST_DATA c ON (a.Timestamp = b.Date_Time OR a.Timestamp = TRUNC(c.Date_Time, 'MON'))

WHERE 
    b.SOURCE = 'PRODUCT'
    AND a.Timestamp IS NOT NULL

GROUP BY 
    a.Timestamp,
    a.NET_PROD,
    a.NET_PRODUCTIVITY,
    a.ACTUAL_AVAILABILITY,
    b.FE,
    b.CAO,
    b.SIO2,
    b.AL2O3,
    b.P,
    b.K2O,
    b.CCS_CRMT,
    b.TUMBLER_PLS_6P3_MM,
    b.TUMBLER_MIN_0P5_MM,
    b.SWELLING_INDEX_CRMT,
    b.RDI,
    b.RI;