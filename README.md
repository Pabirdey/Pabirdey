CREATE OR REPLACE PROCEDURE SAVE_RAW_MATERIAL (
    P_PILE_NO     IN VARCHAR2,
    P_SOURCE      IN VARCHAR2,
    P_SHIFT       IN VARCHAR2,
    P_START_DATE  IN DATE,
    P_END_DATE    IN DATE,
    P_CONS_DATE   IN DATE,
    P_ITEM_CODE   IN VARCHAR2,
    P_QUANTITY    IN NUMBER
)
IS
BEGIN
    -- Try to update existing
    UPDATE T_PILE_RAWMAT_QUANTITY_NEW
    SET QUANTITY = P_QUANTITY,
        UPDATED_DATE = SYSDATE
    WHERE PILE_NO = P_PILE_NO
      AND ITEM_CODE = P_ITEM_CODE;

    IF SQL%ROWCOUNT = 0 THEN
        -- Insert new record
        INSERT INTO T_PILE_RAWMAT_QUANTITY_NEW
            (PILE_NO, SOURCE, SHIFT, START_DATE, END_DATE, CONS_DATE, ITEM_CODE, QUANTITY, CREATED_DATE)
        VALUES
            (P_PILE_NO, P_SOURCE, P_SHIFT, P_START_DATE, P_END_DATE, P_CONS_DATE, P_ITEM_CODE, P_QUANTITY, SYSDATE);
    END IF;
END;