SELECT 
  a.Timestamp,
  CASE 
    WHEN (
      NVL(a.BASEMIX_CB_BF_SPEC_TODATE,0) +
      NVL(a.BASEMIX_CB_COKEOVEN1_SPEC_TODT,0) +
      NVL(a.BASEMIX_CB_COKEOVEN2_SPEC_TODT,0) +
      NVL(a.BASEMIX_CB_BF2_SPEC_TODATE,0) +
      NVL(a.CB_BF2_SPEC_TODATE,0) +
      NVL(a.CB_BF_SPEC_TODATE,0) +
      NVL(a.CB_COKE_OVEN2_SPEC_TODATE,0) +
      NVL(a.CB_COKE_OVEN_SPEC_TODATE,0) +
      NVL(a.BASEMIX_CB_PURCH_SPEC_TODATE,0) +
      NVL(a.CB_PURCH_SPEC_TODATE,0) +
      NVL(a.BASEMIX_ANTH_COAL_SPEC_TODATE,0)
    ) = 0 THEN NULL
    ELSE ROUND(
      (
        (
          NVL(a.BASEMIX_CB_BF_SPEC_TODATE,0) +
          NVL(a.BASEMIX_CB_COKEOVEN1_SPEC_TODT,0) +
          NVL(a.BASEMIX_CB_COKEOVEN2_SPEC_TODT,0) +
          NVL(a.BASEMIX_CB_BF2_SPEC_TODATE,0) +
          NVL(a.CB_BF2_SPEC_TODATE,0) +
          NVL(a.CB_BF_SPEC_TODATE,0) +
          NVL(a.CB_COKE_OVEN2_SPEC_TODATE,0) +
          NVL(a.CB_COKE_OVEN_SPEC_TODATE,0)
        ) * ROUND(AVG(DECODE(b.VM, 0, NULL, b.VM)), 2) +
        (
          NVL(a.BASEMIX_CB_PURCH_SPEC_TODATE, 0) +
          NVL(a.CB_PURCH_SPEC_TODATE, 0)
        ) * ROUND(AVG(DECODE(c.VM, 0, NULL, c.VM)), 2) +
        (
          NVL(a.BASEMIX_ANTH_COAL_SPEC_TODATE, 0) +
          NVL(a.ANTH_COAL_SPEC_TODATE, 0)
        ) * AVG(DECODE(d.VM, NULL, 0, d.VM))
      ) /
      (
        NVL(a.BASEMIX_CB_BF_SPEC_TODATE,0) +
        NVL(a.BASEMIX_CB_COKEOVEN1_SPEC_TODT,0) +
        NVL(a.BASEMIX_CB_COKEOVEN2_SPEC_TODT,0) +
        NVL(a.BASEMIX_CB_BF2_SPEC_TODATE,0) +
        NVL(a.CB_BF2_SPEC_TODATE,0) +
        NVL(a.CB_BF_SPEC_TODATE,0) +
        NVL(a.CB_COKE_OVEN2_SPEC_TODATE,0) +
        NVL(a.CB_COKE_OVEN_SPEC_TODATE,0) +
        NVL(a.BASEMIX_CB_PURCH_SPEC_TODATE,0) +
        NVL(a.CB_PURCH_SPEC_TODATE,0) +
        NVL(a.BASEMIX_ANTH_COAL_SPEC_TODATE,0)
      ),
      2
    )
  END AS VM
FROM ...