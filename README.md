  <div class="modal fade" id="mgClayOtherModal" tabindex="-1">
        <div class="modal-dialog modal-md modal-dialog-centered">
            <div class="modal-content">
                <!-- HEADER -->
                <div class="modal-header">
                    <h5 class="modal-title w-100 text-center">MG_CLAY</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <!-- BODY -->
                <div class="modal-body">
                    <div class="title-box">Weightage of Clay</div>
                    <div class="clay-box">
                        <!-- Clay 1 (DROPDOWN) -->
                        <div class="row align-items-center mb-3">
                            <div class="col-2 clay-label">Clay1</div>
                            <div class="col-7">
                                <select class="form-select clay-input" id="MG_CLAY1">
                                    <option value="">-- Select Clay1 --</option>
                                    <option>ACE</option>
                                    <option>BRL</option>
                                    <option>LRH</option>
                                    <option>UBQ</option>
                                    <option>CALDYRS</option>
                                    <option>HARIMA(S)</option>
                                    <option>HARIMA(D)</option>
                                    <option>CORUS</option>
                                    <option>TRB</option>
                                    <option>VISUVIUS</option>
                                    <option>HARIMA-TWH4</option>
                                    <option>HARIMA-CPH4</option>
                                    <option>HARIMA(D)-TWH5</option>
                                    <option>HARIMA(D)-TWH5K</option>
                                    <option>HARIMA(D)TWH-5T</option>
                                    <option>HARIMA RWH-3</option>
                                    <option>HARIMA RWH-4</option>
                                    <option>HARIMA(S)RW5F</option>
                                    <option>HARIMA RWH-5</option>
                                    <option>HARIMA RWH-6</option>
                                    <option>HARIMA CB1</option>
                                    <option>RW5F</option>
                                    <option>RG15</option>
                                    <option>RG15K</option>
                                    <option>HARIMA(D)TWH-7</option>
                                    <option>HARIMA CB2</option>
                                    <option>TWH5(BELPAHAR)</option>
                                    <option>CB2(BELPAHAR)</option>
                                    <option>TWH 8(BELPAHAR)</option>
                                    <option>TWH 8 K 1(BELPAHAR)</option>
                                </select>
                            </div>
                            <div class="col-3">
                                <select class="form-select clay-input" id="P1">
                                    <option value="">%</option>
                                    <option>5</option>
                                    <option>10</option>
                                    <option>15</option>
                                    <option>20</option>
                                    <option>25</option>
                                    <option>30</option>
                                    <option>35</option>
                                    <option>40</option>
                                    <option>45</option>
                                    <option>50</option>
                                    <option>55</option>
                                    <option>60</option>
                                    <option>65</option>
                                    <option>70</option>
                                    <option>75</option>
                                    <option>80</option>
                                    <option>85</option>
                                    <option>90</option>
                                    <option>95</option>
                                    <option>100</option>
                                </select>
                            </div>
                        </div>
                        <!-- Clay 2 -->
                        <div class="row align-items-center mb-3">
                            <div class="col-2 clay-label">Clay2</div>
                            <div class="col-7">
                                <select class="form-select clay-input" id="MG_CLAY2">
                                    <option value="">-- Select Clay2 --</option>
                                    <option>ACE</option>
                                    <option>BRL</option>
                                    <option>LRH</option>
                                    <option>UBQ</option>
                                    <option>CALDYRS</option>
                                    <option>HARIMA(S)</option>
                                    <option>HARIMA(D)</option>
                                    <option>CORUS</option>
                                    <option>TRB</option>
                                    <option>VISUVIUS</option>
                                    <option>HARIMA-TWH4</option>
                                    <option>HARIMA-CPH4</option>
                                    <option>HARIMA(D)-TWH5</option>
                                    <option>HARIMA(D)-TWH5K</option>
                                    <option>HARIMA(D)TWH-5T</option>
                                    <option>HARIMA RWH-3</option>
                                    <option>HARIMA RWH-4</option>
                                    <option>HARIMA(S)RW5F</option>
                                    <option>HARIMA RWH-5</option>
                                    <option>HARIMA RWH-6</option>
                                    <option>HARIMA CB1</option>
                                    <option>RW5F</option>
                                    <option>RG15</option>
                                    <option>RG15K</option>
                                    <option>HARIMA(D)TWH-7</option>
                                    <option>HARIMA CB2</option>
                                    <option>TWH5(BELPAHAR)</option>
                                    <option>CB2(BELPAHAR)</option>
                                    <option>TWH 8(BELPAHAR)</option>
                                    <option>TWH 8 K 1(BELPAHAR)</option>
                                </select>
                            </div>
                            <div class="col-3">
                                <select class="form-select clay-input" id="P2">
                                    <option value="">%</option>
                                    <option>5</option>
                                    <option>10</option>
                                    <option>15</option>
                                    <option>20</option>
                                    <option>25</option>
                                    <option>30</option>
                                    <option>35</option>
                                    <option>40</option>
                                    <option>45</option>
                                    <option>50</option>
                                    <option>55</option>
                                    <option>60</option>
                                    <option>65</option>
                                    <option>70</option>
                                    <option>75</option>
                                    <option>80</option>
                                    <option>85</option>
                                    <option>90</option>
                                    <option>95</option>
                                    <option>100</option>
                                </select>
                            </div>
                        </div>
                        <!-- Clay 3 -->
                        <div class="row align-items-center">
                            <div class="col-2 clay-label">Clay3</div>
                            <div class="col-7">
                                <select class="form-select clay-input" id="MG_CLAY3">
                                    <option value="">-- Select Clay3 --</option>
                                    <option>ACE</option>
                                    <option>BRL</option>
                                    <option>LRH</option>
                                    <option>UBQ</option>
                                    <option>CALDYRS</option>
                                    <option>HARIMA(S)</option>
                                    <option>HARIMA(D)</option>
                                    <option>CORUS</option>
                                    <option>TRB</option>
                                    <option>VISUVIUS</option>
                                    <option>HARIMA-TWH4</option>
                                    <option>HARIMA-CPH4</option>
                                    <option>HARIMA(D)-TWH5</option>
                                    <option>HARIMA(D)-TWH5K</option>
                                    <option>HARIMA(D)TWH-5T</option>
                                    <option>HARIMA RWH-3</option>
                                    <option>HARIMA RWH-4</option>
                                    <option>HARIMA(S)RW5F</option>
                                    <option>HARIMA RWH-5</option>
                                    <option>HARIMA RWH-6</option>
                                    <option>HARIMA CB1</option>
                                    <option>RW5F</option>
                                    <option>RG15</option>
                                    <option>RG15K</option>
                                    <option>HARIMA(D)TWH-7</option>
                                    <option>HARIMA CB2</option>
                                    <option>TWH5(BELPAHAR)</option>
                                    <option>CB2(BELPAHAR)</option>
                                    <option>TWH 8(BELPAHAR)</option>
                                    <option>TWH 8 K 1(BELPAHAR)</option>
                                </select>
                            </div>
                            <div class="col-3">
                                <select class="form-select clay-input" id="P3">
                                    <option value="">%</option>
                                    <option>5</option>
                                    <option>10</option>
                                    <option>15</option>
                                    <option>20</option>
                                    <option>25</option>
                                    <option>30</option>
                                    <option>35</option>
                                    <option>40</option>
                                    <option>45</option>
                                    <option>50</option>
                                    <option>55</option>
                                    <option>60</option>
                                    <option>65</option>
                                    <option>70</option>
                                    <option>75</option>
                                    <option>80</option>
                                    <option>85</option>
                                    <option>90</option>
                                    <option>95</option>
                                    <option>100</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- FOOTER -->
                <div class="modal-footer justify-content-center">
                    <button class="btn btn-save" onclick="checkClay()">Save</button>
                    <button class="btn btn-exit" data-bs-dismiss="modal">Exit</button>
                </div>
            </div>
        </div>
    </div>
 function Display_Mudgun_Details(date, furnace){
                $.ajax({
                    url: '@Url.Action("Get_Display_Mudgun_Details","CastHouse")',
                    type: 'GET',
                    data: { Fdate: date, Fur: furnace },
                    success: function(result){
                        let parsedData = JSON.parse(result);
                        let tableBody = "";
                        for(let i=0;i<parsedData.length;i++){
                            tableBody += "<tr>";
                            tableBody += `<tr data-castno='${parsedData[i].CAST_NO}'>`;
                            tableBody += `<td class="freeze-col">${parsedData[i].CAST_NO}</td>`;
                            tableBody += `<td>
                                            <select class="form-select form-select-sm">
                                                <option value="" ${parsedData[i].CLOSURE_MODE==""?'selected':''}></option>
                                                <option value="MUDGUN" ${parsedData[i].CLOSURE_MODE=="MUDGUN"?'selected':''}>MUDGUN</option>
                                                <option value="NULL" ${parsedData[i].CLOSURE_MODE=="NULL"?'selected':''}>NULL</option>
                                            </select>
                                          </td>`;
                            tableBody += `<td><input class="form-control form-control-sm" value="${parsedData[i].CLAY_QUANTITY}"></td>`;
                            // Editable MG Clay input + dropdown + modal
                            tableBody += `<td>
                                            <div class="mgClayWrapper">
                                                <input type="text" class ="form-control form-control-sm mgClayInput" value="${parsedData[i].MG_CLAY_USED}">
                                                <button type="button" class="btn btn-sm btn-secondary" onclick="showDropdown(this)">â–¼</button>
                                                <div class="mgClayList">
                                                    <div onclick="selectClay(this, ${i})">ACE</div>
                                                    <div onclick="selectClay(this, ${i})">BRL</div>
                                                    <div onclick="selectClay(this, ${i})">LRH</div>
                                                    <div onclick="selectClay(this, ${i})">UBQ</div>
                                                    <div onclick="selectItem(this, ${i})">CALDYRS</div>
                                                    <div onclick="selectItem(this, ${i})">HARIMA(S)</div>
                                                    <div onclick="selectItem(this, ${i})">HARIMA(D)</div>
                                                    <div onclick="selectItem(this, ${i})">CORUS</div>
                                                    <div onclick="selectItem(this, ${i})">TRB</div>
                                                    <div onclick="selectItem(this, ${i})">VISUVIUS</div>
                                                    <div onclick="selectItem(this, ${i})">HARIMA-TWH4</div>
                                                    <div onclick="selectItem(this, ${i})">HARIMA-CPH4</div>
                                                    <div onclick="selectItem(this, ${i})">HARIMA(D)-TWH5</div>
                                                    <div onclick="selectItem(this, ${i})">HARIMA(D)-TWH5K</div>
                                                    <div onclick="selectItem(this, ${i})">HARIMA(D)TWH-5T</div>
                                                    <div onclick="selectItem(this, ${i})">HARIMA RWH-3</div>
                                                    <div onclick="selectItem(this, ${i})">HARIMA RWH-4</div>
                                                    <div onclick="selectItem(this, ${i})">HARIMA(S)RW5F</div>
                                                    <div onclick="selectItem(this, ${i})">HARIMA RWH-5</div>
                                                    <div onclick="selectItem(this, ${i})">HARIMA RWH-6</div>
                                                    <div onclick="selectItem(this, ${i})">HARIMA CB1</div>
                                                    <div onclick="selectItem(this, ${i})">RW5F</div>
                                                    <div onclick="selectItem(this, ${i})">RG15</div>
                                                    <div onclick="selectItem(this, ${i})">RG15K</div>
                                                    <div onclick="selectItem(this, ${i})">HARIMA(D)TWH-7</div>
                                                    <div onclick="selectItem(this, ${i})">HARIMA CB2</div>
                                                    <div onclick="selectItem(this, ${i})">TWH5(BELPAHAR) </div>
                                                    <div onclick="selectItem(this, ${i})">CB2(BELPAHAR) </div>
                                                    <div onclick="selectItem(this, ${i})">TWH 8(BELPAHAR) </div>
                                                    <div onclick="selectItem(this, ${i})">TWH 8 K 1(BELPAHAR) </div>
                                                    <div onclick="selectClay(this, ${i})">OTHERS</div>
                                                </div>
                                            </div>
                                          </td>`;

                            /* ******** LOT NO TEXTBOX + BUTTON HERE ******** */
                            tableBody += `<td class="d-flex gap-0"><input name="LOT_NO" style="width:120px;"  value='${parsedData[i].LOT_NO}' />
                                        <button type="button" class ="btn btn-primary btn-sm getLot" data-castno="${parsedData[i].LOT_NO}">::</button></td>`;
                            tableBody += `<td><input name="NO_OF_BAGS" class='form-control form-control-sm' value='${parsedData[i].NO_OF_BAGS}'/></td>`;
                            tableBody += `<td><input name="MUDGUN_HOLD_TIME" class='form-control form-control-sm' value='${parsedData[i].MUDGUN_HOLD_TIME}'/></td>`;
                            tableBody += `<td>
                                                <select name="MUDGUN_NOZZLE" class ='form-select form-control-sm'>
                                                        <option ${!parsedData[i].MUDGUN_NOZZLE ? 'selected' : ''} value=""></option>
                                                        <option ${parsedData[i].MUDGUN_NOZZLE === 'REPLACEMENT' ? 'selected' : ''}>REPLACEMENT</option>
                                                        <option ${parsedData[i].MUDGUN_NOZZLE === 'WEILD' ? 'selected' : ''}>WEILD</option>
                                                </select>
                                        </td>`;
                            tableBody += `<td><input name="MNOZZLE_BEF_CLOSING" class='form-control form-control-sm' value='${parsedData[i].MNOZZLE_BEF_CLOSING}'/></td>`;
                            tableBody += `<td><input name="MNOZZLE_AFT_CLOSING" class='form-control form-control-sm' value='${parsedData[i].MNOZZLE_AFT_CLOSING}'/></td>`;
                            tableBody += `<td><input name="INIT_PLUGIN_PRESSURE" class='form-control form-control-sm' value='${parsedData[i].INIT_PLUGIN_PRESSURE}'/></td>`;
                            tableBody += `<td><input name="MAX_PLUGIN_PRESSURE" class='form-control form-control-sm' value='${parsedData[i].MAX_PLUGIN_PRESSURE}'/></td>`;
                            tableBody += `<td><input name="FINAL_PLUGIN_PRESSURE" class='form-control form-control-sm' value='${parsedData[i].FINAL_PLUGIN_PRESSURE}'/></td>`;
                            tableBody += `<td><input name="PRESS_ON_FORCE" class='form-control form-control-sm' value='${parsedData[i].PRESS_ON_FORCE}'/></td>`;
                            tableBody += `<td>
                                        <select name="CLAY_LEAKAGE" class ='form-select form-control-sm'>
                                    <option ${!parsedData[i].CLAY_LEAKAGE ? 'selected' : ''} value=""></option>
                                    <option ${parsedData[i].CLAY_LEAKAGE === 'YES' ? 'selected' : ''}>YES</option>
                                    <option ${parsedData[i].CLAY_LEAKAGE === 'NO' ? 'selected' : ''}>NO</option>
                                </select>
                            </td>`;

                            tableBody += `<td>
                                <select name="BACK_FIRE" class ='form-select form-control-sm'>
                                    <option ${!parsedData[i].BACK_FIRE ? 'selected' : ''} value=""></option>
                                    <option ${parsedData[i].BACK_FIRE === 'YES' ? 'selected' : ''}>YES</option>
                                    <option ${parsedData[i].BACK_FIRE === 'NO' ? 'selected' : ''}>NO</option>
                                </select>
                            </td>`;

                            tableBody += `</tr>`;
                        }

                        $("#Mudgun_Details tbody").html(tableBody);
                    }
                });
            }
            // Show dropdown
function showDropdown(btn){
    var lists = document.querySelectorAll('.mgClayList');
    for(var i=0;i<lists.length;i++){ lists[i].style.display='none'; }
    var list = btn.nextElementSibling;
    list.style.display = 'block';
    document.addEventListener('click', function handler(e){
        if(!list.contains(e.target) && e.target !== btn){
            list.style.display = 'none';
            document.removeEventListener('click', handler);
        }
    });
}

// Select item from dropdown
function selectClay(item, rowIndex){
    var list = item.parentElement;
    var input = list.previousElementSibling;
    if(item.innerText === "OTHERS"){
        $("#hdnRowIndex").val(rowIndex);
        $("#txtOtherMGClay").val(input.value); // show current value
        let modalEl = document.getElementById("mgClayOtherModal");
        let modal = new bootstrap.Modal(modalEl);
        modal.show();
    } else {
        input.value = item.innerText;
    }
    list.style.display = 'none';
}

// Save from modal
function saveOtherMGClay() {
    debugger;
    let rowIndex = $("#hdnRowIndex").val();
    let val = $("#txtOtherMGClay").val().trim();
    if(!val){ alert("Enter value"); return; }
    var row = document.querySelectorAll("#Mudgun_Details tbody tr")[rowIndex];
    var input = row.querySelector(".mgClayInput");
    input.value = val;

    let modalEl = document.getElementById("mgClayOtherModal");
    let modal = bootstrap.Modal.getInstance(modalEl);
    if(modal) modal.hide();
}
    </script>  
    <script>

function checkClay() {
    var P1 = Number(document.getElementById("P1").value) || 0;
    var P2 = Number(document.getElementById("P2").value) || 0;
    var P3 = Number(document.getElementById("P3").value) || 0;
    var MG1 = MG_CLAY1.value;
    var MG2 = MG_CLAY2.value;
    var MG3 = MG_CLAY3.value;
    var P_Sum = P1 + P2 + P3;
    // -------- If NOT 100 ----------
    if (P_Sum !== 100) {
        alert("Sum of Percentage is " + P_Sum + ". It should be 100.");
        // MG_CLAY_USED.value = "Sum is " + P_Sum + "%. It should be 100%";
        return;
    }
    // -------- If 100 ----------
    var result = "";
    if (MG1 && !MG2 && !MG3)
        result = MG1 + "(" + P1 + "%)";
    if (MG1 && MG2 && !MG3)
        result = MG1 + "(" + P1 + "%)+" + MG2 + "(" + P2 + "%)";
    if (MG1 && MG2 && MG3)
        result = MG1 + "(" + P1 + "%)+" + MG2 + "(" + P2 + "%)+" + MG3 + "(" + P3 + "%)";
    if (!MG1 && MG2 && !MG3)
        result = MG2 + "(" + P2 + "%)";
    if (!MG1 && MG2 && MG3)
        result = MG2 + "(" + P2 + "%)+" + MG3 + "(" + P3 + "%)";
    if (!MG1 && !MG2 && MG3)
        result = MG3 + "(" + P3 + "%)";
    if (MG1 && !MG2 && MG3)
        result = MG1 + "(" + P1 + "%)+" + MG3 + "(" + P3 + "%)";
    if (!MG1 && !MG2 && !MG3)
        result = "";
    MG_CLAY_USED.value = result;
}

    </script>
