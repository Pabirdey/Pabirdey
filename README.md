create or replace PROCEDURE PROC_TSM_DRI_DELAY_DAILY AS
    vMAXDATE DATE;
BEGIN
  
    EXECUTE IMMEDIATE 'ALTER SESSION SET NLS_DATE_FORMAT=''DD-MON-YYYY HH24:MI:SS''';  
    SELECT MAX(DATE_TIME) INTO vMAXDATE FROM TSBSL.T_TSM_DRI_DELAYS_DAILY;
    IF vMAXDATE IS NULL THEN
        vMAXDATE := TO_DATE('01-DEC-2025', 'DD-MON-YYYY');
    END IF;
    For k in (Select START_TIMESTAMP,PLANT,AGENCY From TSBSL.T_TSM_DRI_DELAYS where PLANT='DRI - KILN 1' AND START_TIMESTAMP>='01-NOV-2025' AND END_TIMESTAMP<='01-DEC-2025' AND AGENCY='Operation' Order by Timestamp)
    Loop
        Begin
        
        Exception
        When Others Then NUll;
        END:
END LOOP;  

EXCEPTION
WHEN OTHERS THEN
DBMS_OUTPUT.PUT_LINE('General Error: ' || SQLERRM);
END;
